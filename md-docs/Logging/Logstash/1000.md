```ruby
filter {
    ruby {
        init => '
            # init
        '
        code => '
            # execution
        '
    }
}
```

`init`

```ruby
TYPE_MAP = {
    Array=>"list", Hash=>"obj", TrueClass=>"bool", FalseClass=>"bool",
    NilClass=>"null", Integer=>"int", Float=>"float", BigDecimal=>"float"
}

def detect(event, c, b)
    p = c.empty? ? b : "#{c}[#{b}]"
    return unless event.include?(p)

    t0 = Process.clock_gettime(Process::CLOCK_MONOTONIC, :nanosecond)

    v  = event.get(p)
    t  = TYPE_MAP[v.class] || "str"

    event.set(c.empty? ? "#{b}_#{t}" : "#{c}[#{b}_#{t}]", v)
    event.remove(p)

    elapsed = (Process.clock_gettime(Process::CLOCK_MONOTONIC, :nanosecond) - t0) / 1000
    n = c.empty? ? "" : c[1..-2]
    event.set("[logging][debug][field_detection][#{b}]#{n.empty? ? "" : "[#{n}]" }[time_us]", elapsed)
end
```

`execution`
```ruby
detect(event, "", "context")
detect(event, "[dupa]", "context")
```
