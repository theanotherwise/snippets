```ruby
filter {
    ruby {
        init => '
            # init
        '
        code => '
            # execution
        '
    }
}
```

`init`

```ruby
def detect_root(event, b)
    v = event.get(b)
    return unless !v.nil? || event.include?(b)
    t =
        case v
        when Array then "list"
        when Hash then "obj"
        when TrueClass, FalseClass then "bool"
        when NilClass then "null"
        when Integer then "int"
        when Float, BigDecimal then "float"
        else "str"
        end
    event.set("#{b}_#{t}", v)
    event.remove(b)
end

def detect_ns(event, c, b)
    p = "#{c}[#{b}]"
    v = event.get(p)
    return unless !v.nil? || event.include?(p)
    t =
        case v
        when Array then "list"
        when Hash then "obj"
        when TrueClass, FalseClass then "bool"
        when NilClass then "null"
        when Integer then "int"
        when Float, BigDecimal then "float"
        else "str"
        end
    event.set("#{c}[#{b}_#{t}]", v)
    event.remove(p)
end
```

`execution`
```ruby
detect(event, "", "context")
detect(event, "[dupa]", "context")
```
