```ruby
filter {
    ruby {
        init => '
            # init
        '
        code => '
            # execution
        '
    }
}
```

`init`

```ruby
def detect_type(v)
    case v
    when Array then "list"
    when Hash then "obj"
    when TrueClass, FalseClass then "bool"
    when NilClass then "null"
    when Integer then "int"
    when Float, BigDecimal then "float"
    else "str"
    end
end

def fetch(event, path)
    v = event.get(path)
    return nil, nil if v.nil? && !event.include?(path)
    [v, detect_type(v)]
end

def detect_root(event, b)
    v, t = fetch(event, b)
    return unless v
    event.set("#{b}_#{t}", v)
    event.remove(b)
end

def detect_ns(event, c, b)
    p = "#{c}[#{b}]"
    v, t = fetch(event, p)
    return unless v
    event.set("#{c}[#{b}_#{t}]", v)
    event.remove(p)
end
```

`execution`
```ruby
detect_root(event, "context")
detect_ns(event, "[dupa]", "context")
```
